<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Online Checkers</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    background: #111;
    color: #ddd;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  body { display: grid; place-items: center; }
  canvas {
    background: #222;
    box-shadow: 0 10px 30px rgba(0,0,0,.4);
    touch-action: none;
    image-rendering: pixelated;
  }
  .hint {
    position: fixed; bottom: 10px; left: 10px; right: 10px;
    text-align: center; font-size: 12px; color: #aaa;
  }
</style>

<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
</head>
<body>
<canvas id="c"></canvas>
<div class="hint">
  Tap/click a piece, then a highlighted square. Forced captures, multi-jumps, and kinging (with a crown).
  A shareable link is generated on first load for online play.
</div>

<script>
// Firebase config (your project)
const firebaseConfig = {
  apiKey: "AIzaSyBLwAtA3YDgy50jmGUne1IH46J6Z-WIbW0",
  authDomain: "checkers-672d8.firebaseapp.com",
  projectId: "checkers-672d8",
  storageBucket: "checkers-672d8.firebasestorage.app",
  messagingSenderId: "921336245534",
  appId: "1:921336245534:web:5ff4fe493cb8e62eee6d0f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Minimal Base64 piece images (embedded)
const DATA_URI_P1 = "data:image/png;base64,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";
const DATA_URI_P2 = "data:image/png;base64,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";
// Crown SVG (Base64)
const CROWN_URI = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCIgYXJpYS1sYWJlbD0iY3Jvd24iIHJvbGU9ImltZyI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSJub25lIi8+PHJlY3QgeD0iMTAiIHk9IjQyIiB3aWR0aD0iNDQiIGhlaWdodD0iOCIgcng9IjIiIGZpbGw9IiNmNWMzMDAiIHN0cm9rZT0iIzhhNWIwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTEyIDQyIEwyMCAyMiAzMiAzNiA0NCAyMCA1MiA0MiBaIiBmaWxsPSIjZmZkNTRhIiBzdHJva2U9IiM4YTViMDAiIHN0cm9rZS13aWR0aD0iMiIvPjxjaXJjbGUgY3g9IjIwIiBjeT0iNDIiIHI9IjMiIGZpbGw9IiMzZmIzZmYiIHN0cm9rZT0iIzI0NWI3YSIgc3Ryb2tlLXdpZHRoPSIxIi8+PGNpcmNsZSBjeD0iMzIiIGN5PSI0MiIgcj0iMyIgZmlsbD0iI2ZmNGZhMyIgc3Ryb2tlPSIjN2EyNDRlIiBzdHJva2Utd2lkdGg9IjEiLz48Y2lyY2xlIGN4PSI0NCIgY3k9IjQyIiByPSIzIiBmaWxsPSIjN2FmZjdhIiBzdHJva2U9IiMyZTZhMmUiIHN0cm9rZS13aWR0aD0iMSIvPjwvc3ZnPg==";

// Canvas/board
const N=8; let T;
const c=document.getElementById('c'), ctx=c.getContext('2d');
const img1=new Image(), img2=new Image(), crownImg=new Image();
img1.src=DATA_URI_P1; img2.src=DATA_URI_P2; crownImg.src=CROWN_URI;

const LCOL="#cba", DCOL="#654";
let turn=1, sel=null, moves=[], forced=[];
// 0 empty, 1 P1 man, 2 P2 man, 3 P1 king, 4 P2 king
let B=[...Array(N)].map(()=>Array(N).fill(0));
for(let r=0;r<3;r++) for(let cc=0;cc<N;cc++) if((r+cc)%2) B[r][cc]=2;
for(let r=N-3;r<N;r++) for(let cc=0;cc<N;cc++) if((r+cc)%2) B[r][cc]=1;

function fitCanvas(){
  const cssSize=Math.floor(Math.min(window.innerWidth,window.innerHeight)*0.95);
  const dpr=window.devicePixelRatio||1;
  c.style.width=c.style.height=cssSize+"px";
  c.width=c.height=Math.round(cssSize*dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
  T=Math.floor(cssSize/N);
}
fitCanvas(); window.addEventListener('resize',()=>{fitCanvas();draw();});

function owner(v){return(v===1||v===3)?1:(v===2||v===4)?2:0}
function isKing(v){return v===3||v===4}
function asKing(v){return owner(v)===1?3:4}
function opp(p){return p===1?2:1}
function inside(x,y){return x>=0&&x<N&&y>=0&&y<N}
function dirSet(v){if(isKing(v))return[-1,1];return owner(v)===1?[-1]:[1]}

function draw(){
  for(let r=0;r<N;r++){for(let col=0;col<N;col++){
    ctx.fillStyle=((r+col)&1)?DCOL:LCOL; ctx.fillRect(col*T,r*T,T,T);
    if(sel&&moves.some(m=>m.r===r&&m.c===col)){ctx.globalAlpha=.35;ctx.fillStyle="#4af";ctx.fillRect(col*T,r*T,T,T);ctx.globalAlpha=1;}
    else if(!sel&&forced.some(f=>f.r===r&&f.c===col)){ctx.globalAlpha=.25;ctx.fillStyle="#fa4";ctx.fillRect(col*T,r*T,T,T);ctx.globalAlpha=1;}

    const v=B[r][col]; if(!v) continue;
    const im=(owner(v)===1?img1:img2);
    const pad=Math.max(4,Math.round(T*.08)); const pieceSize=T-2*pad;
    const px=col*T+(T-pieceSize)/2, py=r*T+(T-pieceSize)/2;
    ctx.drawImage(im,px,py,pieceSize,pieceSize);
    if(isKing(v)){
      const crownW=Math.round(T*.55), crownH=Math.round(T*.35);
      const cx=col*T+(T-crownW)/2, cy=r*T+Math.round(T*.02)-crownH;
      ctx.drawImage(crownImg,cx,cy,crownW,crownH);
    }
    if(sel&&sel.r===r&&sel.c===col){ctx.lineWidth=3;ctx.strokeStyle="#fff";ctx.strokeRect(col*T+2,r*T+2,T-4,T-4);}
  }}}
}

function legalForPiece(r,c,captureOnly=false){
  const v=B[r][c]; if(owner(v)!==turn) return[];
  const dirs=dirSet(v); const list=[],caps=[];
  for(const dy of dirs){for(const dx of[-1,1]){const nr=r+dy,nc=c+dx;
    if(!captureOnly&&inside(nc,nr)&&B[nr][nc]===0)list.push({r:nr,c:nc,cap:null});
    const mr=r+dy,mc=c+dx,jr=r+2*dy,jc=c+2*dx;
    if(inside(jc,jr)&&owner(B[mr][mc])===opp(owner(v))&&B[jr][jc]===0)caps.push({r:jr,c:jc,cap:{r:mr,c:mc}});
  }}}
  return caps.length?caps:(captureOnly?[]:list);
}

function anyCapturesForPlayer(p){for(let r=0;r<N;r++)for(let c=0;c<N;c++){const v=B[r][c];if(owner(v)===p){if(legalForPiece(r,c,true).length)return true;}}return false}
function computeForced(){const f=[];if(!anyCapturesForPlayer(turn))return f;for(let r=0;r<N;r++)for(let c=0;c<N;c++){if(owner(B[r][c])===turn&&legalForPiece(r,c,true).length)f.push({r,c});}return f;}
function recalc(){forced=computeForced();if(sel){const captureOnly=forced.length>0&&!forced.some(f=>f.r===sel.r&&f.c===sel.c);moves=legalForPiece(sel.r,sel.c,captureOnly||forced.length>0);if(forced.length&&!forced.some(f=>f.r===sel.r&&f.c===sel.c)){sel=null;moves=[];}}else moves=[];draw();}

function maybeKing(v,r){if(isKing(v))return v; if(owner(v)===1&&r===0)return asKing(v); if(owner(v)===2&&r===N-1)return asKing(v); return v;}
function endTurnIfWinOrSwitch(){const oppLeft=B.flat().filter(v=>owner(v)===opp(turn)).length; if(oppLeft===0){setTimeout(()=>{alert(`Player ${turn} wins!`);location.reload();},20);return true;} turn=opp(turn);recalc(); if(onlineReady)publishState(); return false;}

function boardPosFromEvent(e){const rect=c.getBoundingClientRect();const cx=(e.clientX??e.touches?.[0]?.clientX)-rect.left;const cy=(e.clientY??e.touches?.[0]?.clientY)-rect.top;return{ x:Math.floor(cx/T), y:Math.floor(cy/T) };}
function handleMoveOrSelect(x,y){
  if(sel&&moves.some(m=>m.r===y&&m.c===x)){
    const m=moves.find(m=>m.r===y&&m.c===x);
    let v=B[sel.r][sel.c]; B[sel.r][sel.c]=0; if(m.cap)B[m.cap.r][m.cap.c]=0;
    const wasKing=isKing(v); v=maybeKing(v,y); B[y][x]=v;
    const becameKing=!wasKing&&isKing(v);
    if(m.cap&&!becameKing){
      sel={r:y,c:x}; const further=legalForPiece(y,x,true);
      if(further.length){ moves=further; forced=[{r:y,c:x}]; draw(); return; }
    }
    sel=null; moves=[]; forced=[]; if(endTurnIfWinOrSwitch())return; return;
  }
  if(owner(B[y][x])===turn){
    if(forced.length&&!forced.some(f=>f.r===y&&f.c===x)) return;
    sel=(sel&&sel.r===y&&sel.c===x)?null:{r:y,c:x}; recalc();
  } else { sel=null; moves=[]; draw(); }
}
function canActOnTurn(){return onlineReady?(turn===mySide):true;}
function handlePointer(e){ e.preventDefault(); if(!canActOnTurn())return; const p=boardPosFromEvent(e); if(p.x==null)return; handleMoveOrSelect(p.x,p.y); }
c.addEventListener('click',handlePointer);
c.addEventListener('touchstart',handlePointer,{passive:false});

// Online play (Firestore, serialized board)
const url=new URL(location.href);
let gameId=url.searchParams.get("game")||Math.random().toString(36).slice(2,10);
if(!url.searchParams.get("game")){ url.searchParams.set("game",gameId); history.replaceState(null,"",url.toString()); alert("Share this link to play online:\n"+url.toString()); }
const gameRef=db.collection("games").doc(gameId);
let seq=0,mySide=null,onlineReady=false;
function serializeBoard(){let s="";for(let r=0;r<N;r++)for(let c=0;c<N;c++)s+=String(B[r][c]);return s;}
function deserializeBoard(s){if(!s||s.length<N*N)return;let k=0;for(let r=0;r<N;r++)for(let c=0;c<N;c++)B[r][c]=Number(s[k++]);}
async function publishState(){try{seq++;await gameRef.update({boardS:serializeBoard(),turn,seq});}catch(err){console.error("Publish error:",err);}}
async function initOnline(){
  try{
    const snap=await gameRef.get();
    if(!snap.exists){
      await gameRef.set({boardS:serializeBoard(),turn,seq:0,created:Date.now(),players:[1]});
      mySide=1;
    }else{
      const data=snap.data()||{};
      const players=Array.isArray(data.players)?data.players.slice():[];
      if(players.length===0){players.push(1);mySide=1;await gameRef.update({players});}
      else if(players.length===1&&!players.includes(2)){players.push(2);mySide=2;await gameRef.update({players});}
      else{alert("Room full. Create a new link."); return;}
      if(data.boardS){deserializeBoard(data.boardS);turn=data.turn||1;seq=data.seq||0;draw();}
    }
    gameRef.onSnapshot(s=>{
      const d=s.data(); if(!d) return;
      if(typeof d.seq==="number"&&d.seq>seq){deserializeBoard(d.boardS);turn=d.turn;seq=d.seq;sel=null;moves=[];forced=[];draw();}
    });
    onlineReady=true;
  }catch(err){console.error("Online init error:",err); alert("Online init error: "+err.message);}
}
img1.onload=()=>{ img2.onload=()=>{ recalc(); initOnline(); }; };
</script>
</body>
</html>

